<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover"/>
<meta name="theme-color" content="#0f1a14"/>
<meta name="apple-mobile-web-app-capable" content="yes"/>
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"/>
<title>Biblioteca Personal</title>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,700;0,900;1,400;1,700&family=DM+Sans:wght@300;400;500;600&display=swap" rel="stylesheet"/>
<style>
:root {
  --bg:       #0f1a14;
  --surface:  #162019;
  --card:     #1c2a1f;
  --border:   #2a3d2f;
  --green:    #4ade80;
  --green2:   #22c55e;
  --gold:     #d4a853;
  --cream:    #f0e8d8;
  --muted:    #6b8570;
  --danger:   #e05555;
  --r:        10px;
}
*{box-sizing:border-box;margin:0;padding:0;-webkit-tap-highlight-color:transparent}
body{font-family:'DM Sans',sans-serif;background:var(--bg);color:var(--cream);min-height:100vh;overflow-x:hidden}
input,select,textarea,button{font-family:inherit}

/* ‚îÄ‚îÄ HEADER ‚îÄ‚îÄ */
.header{
  background:linear-gradient(160deg,#0a1a0d 0%,#162019 100%);
  padding:28px 20px 20px;
  border-bottom:1px solid var(--border);
  display:flex;align-items:center;gap:16px;
  position:sticky;top:0;z-index:50;
  backdrop-filter:blur(12px);
}
.logo-wrap{
  width:48px;height:48px;border-radius:12px;
  background:linear-gradient(135deg,#1e3a28,#2d5a3a);
  border:1px solid #3a6a45;
  display:flex;align-items:center;justify-content:center;
  flex-shrink:0;box-shadow:0 4px 16px #00000066;
}
.logo-svg{width:28px;height:28px}
.header-text h1{
  font-family:'Playfair Display',serif;
  font-size:20px;font-weight:700;
  color:var(--cream);letter-spacing:0.5px;
  line-height:1.1;
}
.header-text p{font-size:11px;color:var(--muted);letter-spacing:2px;text-transform:uppercase;margin-top:2px}
.header-stats{margin-left:auto;text-align:right;flex-shrink:0}
.header-stats .num{font-family:'Playfair Display',serif;font-size:22px;font-weight:700;color:var(--green);line-height:1}
.header-stats .lbl{font-size:10px;color:var(--muted);letter-spacing:1px;text-transform:uppercase}

/* ‚îÄ‚îÄ NAV ‚îÄ‚îÄ */
.nav{
  display:flex;background:var(--surface);
  border-bottom:1px solid var(--border);
  overflow-x:auto;scrollbar-width:none;flex-shrink:0;
  position:sticky;top:89px;z-index:40;
}
.nav::-webkit-scrollbar{display:none}
.nav-btn{
  padding:13px 18px;background:transparent;border:none;
  color:var(--muted);cursor:pointer;font-size:12px;font-weight:500;
  border-bottom:2px solid transparent;white-space:nowrap;
  transition:all .2s;letter-spacing:.3px;
}
.nav-btn.active{color:var(--cream);border-bottom-color:var(--green)}
.nav-btn:hover:not(.active){color:var(--cream)}

/* ‚îÄ‚îÄ PAGE ‚îÄ‚îÄ */
.page{padding:20px 16px;max-width:900px;margin:0 auto;display:none}
.page.active{display:block}

/* ‚îÄ‚îÄ SECTION HEADER ‚îÄ‚îÄ */
.sh{display:flex;justify-content:space-between;align-items:flex-end;margin-bottom:20px;gap:12px}
.sh-left h2{font-family:'Playfair Display',serif;font-size:22px;color:var(--cream);font-weight:700}
.sh-left p{font-size:11px;color:var(--muted);margin-top:3px;letter-spacing:.5px}

/* ‚îÄ‚îÄ BUTTONS ‚îÄ‚îÄ */
.btn{
  padding:9px 18px;border-radius:8px;border:none;cursor:pointer;
  font-weight:600;font-size:13px;font-family:inherit;
  transition:all .15s;letter-spacing:.2px;
}
.btn-primary{background:var(--green);color:#0a1a0d}
.btn-primary:hover{background:var(--green2);transform:translateY(-1px)}
.btn-ghost{background:rgba(255,255,255,.06);color:var(--cream);border:1px solid var(--border)}
.btn-ghost:hover{background:rgba(255,255,255,.1)}
.btn-sm{padding:5px 12px;font-size:11px}
.btn-danger{background:rgba(224,85,85,.15);color:#f99;border:1px solid rgba(224,85,85,.3)}
.btn-danger:hover{background:rgba(224,85,85,.25)}
.btn-icon{background:rgba(74,222,128,.12);color:var(--green);border:none;padding:5px 9px;border-radius:6px;cursor:pointer;font-size:12px;transition:background .15s}
.btn-icon:hover{background:rgba(74,222,128,.22)}
.btn-icon.del{background:rgba(224,85,85,.12);color:#f99}
.btn-icon.del:hover{background:rgba(224,85,85,.22)}

/* ‚îÄ‚îÄ FILTERS ‚îÄ‚îÄ */
.filters{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:16px}
.inp{
  background:rgba(0,0,0,.35);border:1px solid var(--border);
  border-radius:8px;padding:9px 12px;color:var(--cream);
  font-size:13px;font-family:inherit;outline:none;
  transition:border-color .15s;
}
.inp:focus{border-color:var(--green)}
.inp::placeholder{color:var(--muted)}
.sel{background:rgba(0,0,0,.35);border:1px solid var(--border);border-radius:8px;padding:9px 12px;color:var(--cream);font-size:12px;font-family:inherit;outline:none;cursor:pointer;appearance:none;background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='8'%3E%3Cpath d='M1 1l5 5 5-5' stroke='%236b8570' stroke-width='1.5' fill='none'/%3E%3C/svg%3E");background-repeat:no-repeat;background-position:right 10px center;padding-right:28px}
.sel option{background:#162019}

/* ‚îÄ‚îÄ TABLE ‚îÄ‚îÄ */
.tbl-wrap{overflow-x:auto;border-radius:var(--r);border:1px solid var(--border)}
table{width:100%;border-collapse:collapse;font-size:13px}
thead tr{background:var(--card)}
th{padding:11px 12px;text-align:left;color:var(--gold);font-weight:600;font-size:11px;letter-spacing:1px;text-transform:uppercase;border-bottom:1px solid var(--border)}
td{padding:10px 12px;border-bottom:1px solid rgba(42,61,47,.5)}
tr:last-child td{border-bottom:none}
tr:hover td{background:rgba(255,255,255,.02)}
.read-check{color:var(--green);font-size:11px;margin-right:4px}
.badge-leido{font-size:10px;color:var(--green);font-weight:600;letter-spacing:.5px}
.badge-pend{font-size:10px;color:#445}

/* ‚îÄ‚îÄ GENRE TAGS ‚îÄ‚îÄ */
.genres{display:flex;flex-wrap:wrap;gap:4px}
.gtag{font-size:10px;padding:2px 8px;border-radius:10px;border:1px solid;white-space:nowrap}

/* ‚îÄ‚îÄ CARDS GRID ‚îÄ‚îÄ */
.cards{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:12px}
.card{
  background:var(--card);border-radius:var(--r);padding:15px;
  border:1px solid var(--border);
  transition:border-color .2s,transform .2s;
  position:relative;overflow:hidden;
}
.card::before{content:'';position:absolute;top:0;left:0;right:0;height:2px;background:linear-gradient(90deg,var(--green),transparent)}
.card:hover{border-color:var(--green);transform:translateY(-2px)}
.card-title{font-family:'Playfair Display',serif;font-size:15px;font-weight:700;color:var(--cream);margin-bottom:3px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
.card-author{font-size:11px;color:var(--muted);margin-bottom:10px}
.card-meta{display:flex;gap:6px;flex-wrap:wrap;margin-bottom:10px;align-items:center}
.meta-chip{font-size:10px;background:rgba(255,255,255,.07);padding:2px 8px;border-radius:10px;color:var(--muted)}
.meta-chip.mes{background:rgba(74,222,128,.1);color:var(--green)}
.card-actions{position:absolute;top:12px;right:12px;display:flex;gap:4px}

/* ‚îÄ‚îÄ SCORE BAR ‚îÄ‚îÄ */
.score-row{display:flex;align-items:center;gap:8px;margin-top:8px}
.score-bar-wrap{flex:1;background:#1a3020;border-radius:3px;height:6px}
.score-bar{height:6px;border-radius:3px;background:linear-gradient(90deg,var(--green2),#86efac);transition:width .5s}
.score-num{font-size:14px;font-weight:700;color:var(--green);font-family:'Playfair Display',serif;min-width:28px;text-align:right}
.score-sub{display:grid;grid-template-columns:1fr 1fr;gap:3px;margin-top:8px}
.score-sub-item{font-size:10px;color:var(--muted)}
.score-sub-item span{color:var(--cream)}

/* ‚îÄ‚îÄ TOTAL SCORE BIG ‚îÄ‚îÄ */
.total-big{font-family:'Playfair Display',serif;font-size:28px;font-weight:900;color:var(--green)}

/* ‚îÄ‚îÄ STAT CARDS ‚îÄ‚îÄ */
.stat-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;margin-bottom:20px}
.stat-card{background:var(--card);border-radius:var(--r);padding:16px 12px;text-align:center;border:1px solid var(--border);border-bottom:2px solid var(--green)}
.stat-num{font-family:'Playfair Display',serif;font-size:26px;font-weight:900;color:var(--green)}
.stat-lbl{font-size:10px;color:var(--muted);text-transform:uppercase;letter-spacing:1px;margin-top:2px}

/* ‚îÄ‚îÄ BAR CHART ‚îÄ‚îÄ */
.bar-row{margin-bottom:10px}
.bar-label{display:flex;justify-content:space-between;font-size:11px;margin-bottom:3px;color:var(--cream)}
.bar-label span{color:var(--green)}
.bar-bg{background:#1a3020;border-radius:3px;height:8px}
.bar-fill{height:8px;border-radius:3px;background:linear-gradient(90deg,var(--green2),#86efac)}

/* ‚îÄ‚îÄ MONTH CHART ‚îÄ‚îÄ */
.month-chart{display:flex;align-items:flex-end;gap:6px;height:130px;overflow-x:auto;padding-bottom:4px}
.month-col{display:flex;flex-direction:column;align-items:center;min-width:32px}
.month-bar{width:20px;border-radius:3px 3px 0 0;background:linear-gradient(0deg,var(--green2),#86efac);position:relative;transition:height .5s}
.month-bar-num{position:absolute;top:-16px;left:50%;transform:translateX(-50%);font-size:9px;color:var(--green);white-space:nowrap}
.month-lbl{font-size:9px;color:var(--muted);margin-top:4px}

/* ‚îÄ‚îÄ RANKING ‚îÄ‚îÄ */
.rank-row{display:flex;align-items:center;gap:10px;padding:10px 0;border-bottom:1px solid rgba(42,61,47,.5)}
.rank-row:last-child{border-bottom:none}
.rank-num{width:28px;height:28px;border-radius:50%;background:#1a3020;color:var(--muted);display:flex;align-items:center;justify-content:center;font-weight:700;font-size:11px;flex-shrink:0}
.rank-num.top{background:var(--green);color:#0a1a0d}
.rank-info{flex:1;min-width:0}
.rank-title{font-size:13px;color:var(--cream);overflow:hidden;text-overflow:ellipsis;white-space:nowrap;font-weight:500}
.rank-author{font-size:11px;color:var(--muted)}

/* ‚îÄ‚îÄ RANDOM ‚îÄ‚îÄ */
.random-btn{
  width:100%;padding:18px;border-radius:12px;border:2px dashed var(--border);
  background:transparent;color:var(--muted);font-size:14px;cursor:pointer;
  font-family:inherit;font-weight:600;letter-spacing:.5px;
  transition:all .2s;display:flex;align-items:center;justify-content:center;gap:10px;
}
.random-btn:hover{border-color:var(--green);color:var(--green);background:rgba(74,222,128,.05)}
.random-result{
  background:var(--card);border-radius:14px;padding:28px;text-align:center;
  border:2px solid var(--green);margin-top:20px;
  animation:fadeIn .4s ease;
}
@keyframes fadeIn{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}
.random-result .rr-icon{font-size:48px;margin-bottom:12px}
.random-result .rr-title{font-family:'Playfair Display',serif;font-size:22px;font-weight:700;color:var(--cream);margin-bottom:6px}
.random-result .rr-author{font-size:13px;color:var(--muted)}

/* ‚îÄ‚îÄ COMPRAR ‚îÄ‚îÄ */
.buy-card{
  background:var(--card);border-radius:var(--r);padding:15px;
  border:1px solid var(--border);display:flex;gap:14px;align-items:center;
  transition:border-color .2s;
}
.buy-card:hover{border-color:var(--gold)}
.buy-score{font-family:'Playfair Display',serif;font-size:32px;font-weight:900;color:var(--green);flex-shrink:0;width:48px;text-align:center}
.buy-info{flex:1;min-width:0}
.buy-title{font-size:14px;font-weight:600;color:var(--cream);overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
.buy-author{font-size:11px;color:var(--muted);margin-top:2px}
.buy-list{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:10px}

/* ‚îÄ‚îÄ MODAL ‚îÄ‚îÄ */
.modal-overlay{position:fixed;inset:0;background:rgba(0,0,0,.8);z-index:200;display:none;align-items:center;justify-content:center;padding:16px}
.modal-overlay.open{display:flex}
.modal{background:var(--surface);border-radius:14px;padding:24px;width:100%;max-width:540px;max-height:92vh;overflow-y:auto;border:1px solid var(--border);animation:fadeIn .25s ease}
.modal h2{font-family:'Playfair Display',serif;font-size:18px;color:var(--cream);margin-bottom:20px}
.modal-head{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px}
.modal-head h2{margin-bottom:0}
.close-btn{background:none;border:none;color:var(--muted);font-size:20px;cursor:pointer;line-height:1;padding:0}

/* ‚îÄ‚îÄ FORM ‚îÄ‚îÄ */
.form-grid{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:12px}
.form-grid.full{grid-template-columns:1fr}
.field{display:flex;flex-direction:column;gap:5px}
.field.span2{grid-column:1/-1}
.field label{font-size:11px;color:var(--muted);text-transform:uppercase;letter-spacing:.8px}
.slider-row{margin-bottom:8px}
.slider-row label{display:flex;justify-content:space-between;font-size:12px;color:var(--muted);margin-bottom:4px}
.slider-row label span{color:var(--gold);font-weight:600}
input[type=range]{width:100%;accent-color:var(--green);cursor:pointer}
.score-box{background:rgba(0,0,0,.3);border-radius:8px;padding:14px;margin:12px 0}
.score-box h3{font-size:12px;color:var(--gold);text-transform:uppercase;letter-spacing:1px;margin-bottom:12px}
.score-result{font-size:15px;color:var(--green);font-weight:700;margin-top:10px}

/* ‚îÄ‚îÄ GENRE MULTI ‚îÄ‚îÄ */
.genre-grid{display:flex;flex-wrap:wrap;gap:6px;margin-top:4px}
.genre-chip{
  padding:4px 11px;border-radius:12px;border:1px solid var(--border);
  background:transparent;color:var(--muted);font-size:11px;
  cursor:pointer;transition:all .15s;font-family:inherit;
}
.genre-chip.on{border-color:var(--green);background:rgba(74,222,128,.12);color:var(--green)}

/* ‚îÄ‚îÄ EMPTY ‚îÄ‚îÄ */
.empty{text-align:center;padding:48px 20px;color:var(--muted)}
.empty .empty-icon{font-size:40px;margin-bottom:12px}
.empty p{font-size:14px}

/* ‚îÄ‚îÄ SPINNER ‚îÄ‚îÄ */
.spinner{display:flex;justify-content:center;padding:40px}
.spin{width:32px;height:32px;border:2px solid var(--border);border-top-color:var(--green);border-radius:50%;animation:spin .7s linear infinite}
@keyframes spin{to{transform:rotate(360deg)}}

/* ‚îÄ‚îÄ TOAST ‚îÄ‚îÄ */
.toast{
  position:fixed;bottom:24px;left:50%;transform:translateX(-50%) translateY(80px);
  background:var(--green);color:#0a1a0d;padding:10px 20px;border-radius:24px;
  font-weight:600;font-size:13px;z-index:500;transition:transform .3s;white-space:nowrap;
}
.toast.show{transform:translateX(-50%) translateY(0)}

/* ‚îÄ‚îÄ MOBILE ‚îÄ‚îÄ */
@media(max-width:520px){
  .form-grid{grid-template-columns:1fr}
  .field.span2{grid-column:1}
  .stat-grid{grid-template-columns:repeat(3,1fr)}
  .header{padding:20px 14px 14px}
  .page{padding:16px 12px}
}
</style>
</head>
<body>

<!-- TOAST -->
<div class="toast" id="toast"></div>

<!-- HEADER -->
<div class="header">
  <div class="logo-wrap">
    <svg class="logo-svg" viewBox="0 0 28 28" fill="none">
      <rect x="3" y="4" width="7" height="20" rx="1.5" fill="#4ade80" opacity=".9"/>
      <rect x="11.5" y="2" width="7" height="22" rx="1.5" fill="#4ade80" opacity=".7"/>
      <rect x="20" y="5" width="5" height="18" rx="1.5" fill="#4ade80" opacity=".5"/>
      <path d="M3 19h22" stroke="#22c55e" stroke-width="1" opacity=".4"/>
    </svg>
  </div>
  <div class="header-text">
    <h1>Biblioteca Personal</h1>
    <p>Mi colecci√≥n de libros</p>
  </div>
  <div class="header-stats">
    <div class="num" id="stat-total">0</div>
    <div class="lbl">libros</div>
  </div>
</div>

<!-- NAV -->
<div class="nav">
  <button class="nav-btn active" data-page="biblioteca">üìö Biblioteca</button>
  <button class="nav-btn" data-page="leidos">‚úÖ Le√≠dos</button>
  <button class="nav-btn" data-page="estadisticas">üìä Stats</button>
  <button class="nav-btn" data-page="aleatorio">üé≤ Aleatorio</button>
  <button class="nav-btn" data-page="comprar">üõí Comprar</button>
</div>

<!-- PAGES -->
<div id="p-biblioteca" class="page active">
  <div class="sh">
    <div class="sh-left"><h2>Mi Biblioteca</h2><p id="bib-count">Cargando...</p></div>
    <button class="btn btn-primary" onclick="openBibForm()">+ A√±adir</button>
  </div>
  <div class="filters">
    <input class="inp" id="bib-search" placeholder="Buscar t√≠tulo o autor..." style="width:200px" oninput="renderBib()"/>
    <select class="sel" id="bib-genre" onchange="renderBib()">
      <option value="">Todos los g√©neros</option>
    </select>
    <button class="btn btn-ghost btn-sm" onclick="clearBibFilters()" id="bib-clear" style="display:none">‚úï Limpiar</button>
  </div>
  <div class="tbl-wrap">
    <table><thead><tr>
      <th>#</th><th>T√≠tulo</th><th>Autor</th><th>G√©neros</th><th>Estado</th><th></th>
    </tr></thead>
    <tbody id="bib-tbody"></tbody></table>
  </div>
  <div id="bib-empty" class="empty" style="display:none">
    <div class="empty-icon">üìö</div>
    <p>Tu biblioteca est√° vac√≠a.<br>¬°A√±ade tu primer libro!</p>
  </div>
</div>

<div id="p-leidos" class="page">
  <div class="sh">
    <div class="sh-left"><h2>Libros Le√≠dos</h2><p id="leidos-count">0 libros</p></div>
    <button class="btn btn-primary" onclick="openLeidoForm()">+ A√±adir le√≠do</button>
  </div>
  <div class="filters">
    <select class="sel" id="l-genre" onchange="renderLeidos()">
      <option value="">Todos g√©neros</option>
    </select>
    <select class="sel" id="l-mes" onchange="renderLeidos()">
      <option value="">Todos los meses</option>
    </select>
    <input class="inp" id="l-search" placeholder="Buscar..." style="width:140px" oninput="renderLeidos()"/>
  </div>
  <div class="cards" id="leidos-cards"></div>
  <div id="leidos-empty" class="empty" style="display:none">
    <div class="empty-icon">‚ú®</div>
    <p>A√∫n no has registrado ning√∫n libro le√≠do.</p>
  </div>
</div>

<div id="p-estadisticas" class="page">
  <div class="sh"><div class="sh-left"><h2>Estad√≠sticas</h2><p>Tu a√±o en libros</p></div></div>
  <div class="stat-grid" id="stat-grid"></div>
  <div style="background:var(--card);border-radius:var(--r);padding:16px;margin-bottom:14px;border:1px solid var(--border)">
    <div style="font-size:12px;color:var(--gold);margin-bottom:14px;font-weight:600;text-transform:uppercase;letter-spacing:1px">üìÖ Libros por mes</div>
    <div class="month-chart" id="month-chart"></div>
  </div>
  <div style="background:var(--card);border-radius:var(--r);padding:16px;margin-bottom:14px;border:1px solid var(--border)">
    <div style="font-size:12px;color:var(--gold);margin-bottom:14px;font-weight:600;text-transform:uppercase;letter-spacing:1px">üìñ Autores m√°s le√≠dos</div>
    <div id="author-chart"></div>
  </div>
  <div style="background:var(--card);border-radius:var(--r);padding:16px;border:1px solid var(--border)">
    <div style="font-size:12px;color:var(--gold);margin-bottom:14px;font-weight:600;text-transform:uppercase;letter-spacing:1px">üèÜ Ranking por nota</div>
    <div id="ranking"></div>
  </div>
</div>

<div id="p-aleatorio" class="page">
  <div class="sh"><div class="sh-left"><h2>Libro Aleatorio</h2><p>D√©jate sorprender</p></div></div>
  <div class="filters">
    <select class="sel" id="rand-genre"><option value="">Cualquier g√©nero</option></select>
    <select class="sel" id="rand-autor"><option value="">Cualquier autor</option></select>
  </div>
  <div id="rand-pool" style="font-size:12px;color:var(--muted);margin-bottom:20px"></div>
  <button class="random-btn" onclick="doRandom()">
    <span style="font-size:22px">üé≤</span> ¬°Recomi√©ndame un libro!
  </button>
  <div id="rand-result" style="display:none"></div>
</div>

<div id="p-comprar" class="page">
  <div class="sh"><div class="sh-left"><h2>Lista de Compra</h2><p>Ebooks le√≠dos con nota ‚â• 7 ¬∑ candidatos a papel</p></div></div>
  <div class="buy-list" id="buy-list"></div>
  <div id="buy-empty" class="empty" style="display:none">
    <div class="empty-icon">üõí</div>
    <p>Ning√∫n ebook supera el 7 a√∫n.</p>
  </div>
</div>

<!-- MODAL BIBLIOTECA -->
<div class="modal-overlay" id="bib-modal">
  <div class="modal">
    <div class="modal-head">
      <h2 id="bib-modal-title">A√±adir libro</h2>
      <button class="close-btn" onclick="closeBibModal()">‚úï</button>
    </div>
    <div class="form-grid">
      <div class="field span2">
        <label>T√≠tulo *</label>
        <input class="inp" id="bm-titulo" placeholder="T√≠tulo del libro" style="width:100%"/>
      </div>
      <div class="field">
        <label>Autor</label>
        <input class="inp" id="bm-autor"
